
--> ‚ùì Question 1: How many users are active?
------------------------------------------

üî≥ Query:

[
  {
    $match: {
      isActive: true
    }
  }
]

üî≥ with count:

[
  {
    $match: {
      isActive: true
    }
  },
  {
    $count: 'activeUsers'
  }
]



============================================

--> ‚ùì Question 2: Calculate the average age?

üî≥ Overall average age:

[
  {
    $group: {
      _id: null,
      averageAge: {
        $avg: "$age"
      }
    }
  }
]

üî≥ Average age gender wise:

[
  {
    $group: {
      _id: "$gender",
      averageAge: {
        $avg: "$age"
      }
    }
  }
]

================================================

--> ‚ùì Question 3: List the top 5 most common fruits among the users?

üî≥ Count of all favouritefruit

[
  {
    $group: {
      _id: "$favoriteFruit",
      count: {
        $sum: 1
      }
    }
  }
]

üî≥ Limit & sort the result

[
  {
    $group: {
      _id: "$favoriteFruit",
      count: {
        $sum: 1
      }
    }
  },
  {
    $sort: {
      count: -1
    }
	},
  {
    $limit: 2
  }
]

==========================================================

--> ‚ùì Question 4: Find the total number of males and females?

üî≥ query

[
  {
    $group: {
      _id: "$gender",
      count: {
        $sum : 1
      }
    }
  }
]

=============================================================

--> ‚ùì Question 5: Which country has the highest number of registered users?

üî≥ group with country and finding the users count with sort descending

[
  {
      $group: {
      	_id: "$company.location.country",
        userCount: {
          $sum: 1
        }
    }
  }, 
  {
    $sort: {
      userCount: -1
    }
  }
]

üî≥ applying limit to 1

[
  {
      $group: {
      	_id: "$company.location.country",
        userCount: {
          $sum: 1
        }
    }
  }, 
  {
    $sort: {
      userCount: -1
    }
  },
  {
    $limit: 1
  }
]

=============================================================

--> ‚ùì Question 6: List all unique eye colors present in the collection?

üî≥ query

[
  {
    $group: {
      _id : "$eyeColor"
    }
  }
]


=============================================================

--> ‚ùì Question 7: What is the average number of tags per user?

üî≥ Using unwind query -- getting the number of tags per id

[
  {
    $unwind: "$tags"
  },
  {
    $group: {
      _id: "$_id",
      numberOfTags: {
        $sum: 1
      }
    }
  }
]

üî≥ Using unwind -- getting average number of tags per user.

[
  {
    $unwind: "$tags"
  },
  {
    $group: {
      _id: "$_id",
      numberOfTags: {
        $sum: 1
      }
    }
  },
  {
    $group: {
      _id: null,
      averageCount: {
        $avg: "$numberOfTags"
      }
    }
  }
]

üî≥ Using different approach

[
  {
    $addFields: {
      tagsCount: {
        $size: {$ifNull: ["$tags", []]}
      }
    }
  },
  {
    $group: {
      _id: null,
      averageNoOfTags: {
        $avg: "$tagsCount"
      }
    }
  }
]

=============================================================

--> ‚ùì Question 8: How many users having 'enim' as one of their tags

üî≥ Users having 'enim' tags

[
  {
    $match: {
      tags: "enim"
    }
  }
]

üî≥ Count of users with 'enim' tags

[
  {
    $match: {
      tags: "enim"
    }
  },
  {
    $count: 'UsersWithEnim'
  }
]

=============================================================

--> ‚ùì Question 9: What are the names and age of users who are inactive and have 'velit' as a tag?

üî≥ Query

[
  {
    $match: {
      "tags": "velit",
      "isActive": false
    }
  },
  {
    $project: {
      name: 1,
      age: 1
    }
  }
]

=============================================================

--> ‚ùì Question 10: How many users have a phone number starting with "+1 (940)" ?

üî≥ Query

[
  {
		$match: {
		  "company.phone": /^\+1 \(940\)/
		}
  },
  {
    $count: 'userWithSpecialPhoneNumber'
  }
]

=============================================================

--> ‚ùì Question 11: Who has registered the most recently?

üî≥ Query

[
  {
    $sort: {
      registered: -1
    }
  },
  {
    $limit: 4
  }
]

üî≥ Only displaying name, registered, and favoriteFruit

[
  {
    $sort: {
      registered: -1
    }
  },
  {
    $limit: 4
  },
  {
    $project: {
      name: 1,
      registered: 1,
      favoriteFruit: 1
    }
  }
]

==============================================================

--> ‚ùì Question 12: Categorize users with their favouritefruit?

üî≥ Query

[
  {
    $group: {
      _id: "$favoriteFruit",
      users: {
        $push: "$name"
      }
    }
  }
]

==============================================================

--> ‚ùì Question 13: How many users have 'ad' as a second tag in their tag list?

üî≥ Query (matching 'ad' as a second tag

[
  {
    $match: {
      "tags.1": "ad" 
    }
  }
]

üî≥ counting total matching 'ad' as a second tag

[
  {
    $match: {
      "tags.1": "ad" 
    }
  },
  {
    $count: 'secondTagAd'
  }
]

==============================================================

--> ‚ùì Question 14: Find the users who has 'enim' and 'id' as their tag?

üî≥ Query 

[
  {
    $match: {
      tags: { $all: ['enim', 'ad']}
    }
  }
]

==============================================================

--> ‚ùì Question 15: List all companies located in the usa with their corresponding user count ?


üî≥ Query 

[
  {
    $match: {
      "company.location.country": "USA",
    },
  },
  {
    $group: {
      _id: "$company.title",
      userCount: {
        $sum: 1
      }
    }
  }
]


==============================================================

--> ‚ùì Question 16: (Books collections) find the details of the author included in the doc?

üî≥ Query -- This query will display the author details in the key author, as array first index

[
  {
    $lookup: {
      from: "authors",
      localField: "author_id",
      foreignField: "_id",
      as: "author"
    }
  }
]

üî≥ Query -- Display as a object

[
  {
    $lookup: {
      from: "authors",
      localField: "author_id",
      foreignField: "_id",
      as: "author"
    }
  },
  {
		$addFields: {
			author: {
				$first: "$author"
      }
		}
  }
]

üî≥ Query -- Second method

[
  {
    $lookup: {
      from: "authors",
      localField: "author_id",
      foreignField: "_id",
      as: "author"
    }
  },
  {
		$addFields: {
			author: {
				$arrayElemAt: ["$author", 0]
      }
		}
  }
]
